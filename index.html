<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tesla Fleet Public Key</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 1rem; max-width: 900px; margin: auto; }
    pre { background:#f6f8fa; padding:1rem; border-radius:6px; white-space:pre-wrap; word-break:break-all; }
    button { padding:.5rem 1rem; margin-top:.5rem; margin-right:.5rem; }
    .muted { color: #666; font-size: 0.95rem; }
    .notice { background:#fff7e6; padding:.75rem; border:1px solid #ffe6a1; border-radius:6px; margin-bottom:1rem; }
  </style>
</head>
<body>
  <h1>Tesla Fleet Public Key</h1>
  <div class="notice">
    <strong>Note:</strong> The public key file (PEM) is not included in this integration. Place the PEM in your Home Assistant configuration directory as described below.
  </div>

  <p class="muted">This page fetches the Tesla Fleet public key from the fixed well-known path:</p>
  <pre>/.well-known/appspecific/com.tesla.3p.public-key.pem</pre>

  <p class="muted">If the PEM is not found at that path, this page will also look for <code>tesla-public-key.pem</code> in your Home Assistant config directory.</p>

  <h2>Public key</h2>
  <pre id="pem">Loading…</pre>
  <div>
    <button id="copy">Copy to clipboard</button>
    <button id="refresh">Refresh</button>
  </div>

  <h3>Where to put the PEM</h3>
  <ol>
    <li><code>&lt;config&gt;/.well-known/appspecific/com.tesla.3p.public-key.pem</code> (recommended)</li>
    <li><code>&lt;config&gt;/tesla-public-key.pem</code></li>
  </ol>

  <p class="muted">Do not place the PEM inside the <code>custom_components/tesla_serve_key</code> integration folder. This repository intentionally does not include the PEM.</p>

  <h3>Troubleshooting</h3>
  <p class="muted">If this page shows "Failed to load key" or the key is missing, verify that the PEM file exists at one of the locations above and that Home Assistant can read it. Check Home Assistant logs for more details.</p>
  <p class="muted">For more details see the project README: https://github.com/JCalvi/tesla_serve_key</p>

  <script>
    async function load() {
      const pemEl = document.getElementById('pem');
      pemEl.textContent = 'Loading…';
      try {
        const r = await fetch('/.well-known/appspecific/com.tesla.3p.public-key.pem');
        if (!r.ok) {
          throw new Error('HTTP ' + r.status);
        }
        const txt = await r.text();
        pemEl.textContent = txt;
      } catch (e) {
        pemEl.textContent = 'Failed to load key. Ensure the PEM is placed in your Home Assistant config directory (see README).\n\nError: ' + e;
      }
    }

    document.getElementById('copy').addEventListener('click', async () => {
      const txt = document.getElementById('pem').textContent;
      try {
        await navigator.clipboard.writeText(txt);
        alert('Copied!');
      } catch (err) {
        alert('Copy failed: ' + err);
      }
    });

    document.getElementById('refresh').addEventListener('click', load);

    load();
  </script>
</body>
</html>
